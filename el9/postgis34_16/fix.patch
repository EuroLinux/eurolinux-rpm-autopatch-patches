diff --git a/postgis34.spec b/postgis34.spec
index 798c61a..d3b1487 100644
--- a/postgis34.spec
+++ b/postgis34.spec
@@ -4,7 +4,78 @@
 %global postgiscurrmajorversion %(echo %{postgismajorversion}|tr -d '.')
 %global sname	postgis
 
-%pgdg_set_gis_variables
+
+# COPIED FROM /usr/lib/rpm/macros.d/macros.pgdg-postgresql
+
+%global geosmajorversion		39
+%global geos312majorversion		312
+%global geos311majorversion		311
+%global geos310majorversion		310
+%global geos39majorversion		39
+%global gdalmajorversion		33
+%global gdal39majorversion		39
+%global gdal38majorversion		38
+%global gdal37majorversion		37
+%global gdal36majorversion		36
+%global gdal35majorversion		35
+%global gdal33majorversion		33
+%global libgeotiffmajorversion		17
+%global libgeotiff17majorversion	17
+%global ogdimajorversion		41
+%global projmajorversion		82
+%global proj94majorversion		94
+%global proj93majorversion		93
+%global proj92majorversion		92
+%global proj91majorversion		91
+%global proj90majorversion		90
+%global proj82majorversion		82
+%global proj81majorversion		81
+%global proj80majorversion		80
+%global proj72majorversion		72
+%global proj71majorversion		71
+%global proj70majorversion		70
+#%global gdalinstdir			/usr/gdal%{gdalmajorversion}
+%global gdal39instdir			/usr/gdal%{gdal39majorversion}
+%global gdal38instdir			/usr/gdal%{gdal38majorversion}
+%global gdal37instdir			/usr/gdal%{gdal37majorversion}
+%global gdal36instdir			/usr/gdal%{gdal36majorversion}
+%global gdal35instdir			/usr/gdal%{gdal35majorversion}
+%global gdal33instdir			/usr/gdal%{gdal33majorversion}
+%global geos310instdir			/usr/geos%{geos310majorversion}
+%global geos311instdir			/usr/geos%{geos311majorversion}
+%global geos312instdir			/usr/geos%{geos312majorversion}
+#%global geosinstdir			/usr/geos%{geosmajorversion}
+%global libgeotiffinstdir		/usr/libgeotiff%{libgeotiffmajorversion}
+%global libgeotiff17instdir		/usr/libgeotiff%{libgeotiff17majorversion}
+%global libspatialiteinstdir		/usr/libspatialite%{libspatialitemajorversion}
+%global ogdiinstdir			/usr/ogdi%{ogdimajorversion}
+#%global projinstdir			/usr/proj%{projmajorversion}
+%global proj94instdir			/usr/proj%{proj94majorversion}
+%global proj93instdir			/usr/proj%{proj93majorversion}
+%global proj92instdir			/usr/proj%{proj92majorversion}
+%global proj91instdir			/usr/proj%{proj91majorversion}
+%global proj82instdir			/usr/proj%{proj82majorversion}
+%global proj72instdir			/usr/proj%{proj72majorversion}
+%global geos312fullversion		3.12.2
+%global geos311fullversion		3.11.4
+%global geos310fullversion		3.10.6
+%global geos39fullversion		3.9.2
+%global geosfullversion			3.9.2
+%global projfullversion			8.1.1
+%global proj94fullversion		9.4.1
+%global proj93fullversion		9.3.1
+%global proj92fullversion		9.2.1
+%global proj91fullversion		9.1.1
+%global proj90fullversion		9.0.1
+%global proj82fullversion		8.2.1
+%global proj72fullversion		7.2.1
+%global gdalfullversion			3.3.3
+%global gdal39fullversion		3.9.1
+%global gdal38fullversion		3.8.4
+%global gdal37fullversion		3.7.2
+%global gdal36fullversion		3.6.3
+%global gdal35fullversion		3.5.3
+%global gdal33fullversion		3.3.3
 
 # Override some variables. PostGIS 3.4 is best served with GeOS 3.12,
 # GDAL 3.8 and PROJ 9.4:
@@ -14,9 +85,10 @@
 %global gdalfullversion %gdal38fullversion
 %global gdalmajorversion %gdal38majorversion
 %global gdalinstdir %gdal38instdir
-%global projmajorversion %proj94majorversion
 %global projfullversion %proj94fullversion
+%global projmajorversion %proj94majorversion
 %global projinstdir %proj94instdir
+%global libgeotiffmajorversion 17
 
 %{!?llvm:%global llvm 1}
 
@@ -205,7 +277,7 @@ LDFLAGS="-Wl,-rpath,%{projinstdir}/lib ${LDFLAGS}" ; export LDFLAGS
 SHLIB_LINK="$SHLIB_LINK -Wl,-rpath,%{geosinstdir}/lib64" ; export SHLIB_LINK
 SFCGAL_LDFLAGS="$SFCGAL_LDFLAGS -L/usr/lib64"; export SFCGAL_LDFLAGS
 
-LDFLAGS="$LDFLAGS -L%{geosinstdir}/lib64 -lgeos_c -L%{projinstdir}/lib -L%{gdalinstdir}/lib -L%{libgeotiffinstdir}/lib -ltiff -L/usr/lib64"; export LDFLAGS
+LDFLAGS="$LDFLAGS -L%{geosinstdir}/lib64 -lgeos_c -L%{projinstdir}/lib64 -L%{gdalinstdir}/lib -L%{libgeotiffinstdir}/lib -ltiff -L/usr/lib64"; export LDFLAGS
 CFLAGS="$CFLAGS -I%{gdalinstdir}/include"; export CFLAGS
 export PKG_CONFIG_PATH=$PKG_CONFIG_PATH:%{projinstdir}/lib64/pkgconfig
 
@@ -214,6 +286,7 @@ autoconf
 %configure --with-pgconfig=%{pginstdir}/bin/pg_config \
 	--bindir=%{pginstdir}/bin/ \
 	--datadir=%{pginstdir}/share/ \
+	--with-projdir=%{projinstdir} \
 	--enable-lto \
 %if !%raster
 	--without-raster \
